using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class StageTemplate : MonoBehaviour
{
    [SerializeField, Header("?G?l?~?[???w???????????m?F????X?N???v?g")]
    public EnemyCollision enemyCollision;

    [SerializeField, Header("main Camera")]
    public GameObject mainCamera;

    [SerializeField, Header("pop???????G?l?~?[??????????çx?X?g")]
    public List<GameObject> popEnemy;

    [SerializeField, Header("pop???????G?l?~?[??o??????????????çx?X?g")]
    public List<int> popEnemyCount;

    [SerializeField, Header("?G?l?~?[?|?b?v?????????")]
    public float lateTime = 1.0f;

    //?X?e?[?W?i?s??
    private int stageCount = 0;

    //???b?o????????????????
    private float time = 0.0f;
    
    //????|?b?v????????????????
    private int popCount = 0;

    void Start()
    {
        Debug.Log("stage:" + (stageCount + 1));
    }

    // Update is called once per frame
    void Update()
    {
        //?G?l?~?[???|?b?v??????b?o?????????v??
        time += Time.deltaTime;

        //lateTime????????????s
        if (time < lateTime)
        {
            return;
        }

        //popCount???|?b?v????????s???? else ??
        //Debug.Log(stageCount);
        if(stageCount >= popEnemy.Count)
        {
            return;
        }
        if (popCount < popEnemyCount[stageCount])
        {
            Pop(popEnemy[stageCount], new Vector3(Random.Range(-GlovalValue.xLimit + 1, GlovalValue.xLimit - 1),
                                 Random.Range(0.0f, GlovalValue.yLimit - 1), 0));
            popCount++;
        }
        else
        {
            //?G?l?~?[????????????????s
            if (!enemyCollision.IsEnemy())
            {
                //popEnemy????X?g??????????????s?????
                if (popEnemy.Count >= stageCount)
                {

                    //????G?l?~?[???|?b?v???????????
                    stageCount += 1;
                    //?|?b?v??????????????I??
                    if (stageCount >= popEnemy.Count)
                    {
                        Debug.Log("CLEAR");
                    }
                    else
                    {
                        Debug.Log("stage:" + (stageCount + 1));
                        popCount = 0;
                    }

                }
            }
        }
        time = 0;
    }

    //?|?b?v???????I?u?W?F?N?g???????u??l??????????|?b?v?????
    public void Pop(GameObject enemyObject,Vector3 initialPosition)
    {
        //?G?l?~?[?I?u?W?F?N?g????
        GameObject enemyObj1 = Instantiate(enemyObject);
        initialPosition.y += GlovalValue.yLimit * 2;
        //?G?l?~?[?I?u?W?F?N?g????W???
        enemyObj1.transform.position = initialPosition;

    }
}
